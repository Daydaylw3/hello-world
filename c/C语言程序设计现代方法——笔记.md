

[toc]

# 十八. 声明

> 

## 18.1 声明的语法

`声明说明符 声明符`

**声明说明符**（declaration specifier）

+ **存储类型**：最多出现一种，必须在最前；一共有4种：`auto、static、extern、register`
+ **类型限定符**：可以包含零个或者多个；C88两种：`const、volatile`。C99还有一种：`restrict`。
+ **类型说明符**：包括结构、联合、枚举的说明，用 `typedef` 创建的类型名也是，关键字 `void、char、short、int、long、float、double、signed、unsigned`
+ **函数说明符**：C99，inline

> 类型限定符 和 类型说明符的相互顺序没有要求

**声明符**（declarator）：包括标识符（简单变量的名字）、后面跟随的 `[]` 标识符（数组名）、前放置 `*` 的标识符（指针名）、后边跟随 `()` 的标识符（函数名）。

## 18.2 存储类型

### 18.2.1 变量的性质

+ **存储期限**：决定为变量预留和内存被释放的时间
  + *自动存储期限*：块终止释放
  + *静态存储期限*：无限期保留
+ **作用域**：可以引用变量的那部分程序文本
  + *块作用域*
  + *文件作用域*
+ **链接**：确定了程序不同部分可以共享此变量的范围
  + *外部链接*：被程序中的几个（或者全部）文件共享
  + *内部链接*：属于单独一个文件，文件中的函数可以共享
  + *无链接*：属于单独一个函数，不能被共享

> 变量的默认存储期限、作用域和链接都依赖于**变量声明的位置**

+ 块：自动存储期限、块作用域、无链接
+ 程序最外层：静态存储期限、文件作用域、外部链接

### 18.2.2 auto 存储类型

只对块内变量有效。自动存储期限、块作用域、无链接

### 18.2.3 static 存储类型

可以用于全部变量

+ 块外部：静态存储期限、文件作用域、**内部链接**
+ 块内部：**静态存储期限**、块作用域、无链接

> 用于块外部，使得变量只在声明它的文件内可见

### 18.2.4 extern 存储类型

让几个源文件可以共享同一个变量

始终有静态存储期限，作用域依赖于声明的位置

+ 块外部：静态存储期限、文件作用域、**什么链接？**
+ 块内部：静态存储期限、块作用域、**什么链接？**

> 如果变量在文件中较早的位置（任何函数定义外部），那么具有内部链接；否则（通常情况下），具有外部链接

### 18.2.5 register 存储类型

要求编译器把变量存储在寄存器中，而不是保存在内存中；是一种请求；

只对块内变量有效。自动存储期限、块作用域、无链接。

不可以对 register 变量使用取地址运算符 &

最好用于需要频繁访问或者更新的变量，比如 for 循环中的控制变量

### 18.2.6 函数的存储类型

选项只有 `extern` 和 `static`

+ extern：外部链接
+ static：内部链接
+ 不指明：外部链接

> 声明函数是 `extern` 如同声明变量是 `auto` 的一样，两者都没有作用

声明函数是 `static` 是十分有用的。声明不打算被其他文件调用的任意函数，建议使用 `static` 存储类型

+ **更容易维护**
+ **减少了 “名字空间污染”**

> 函数的形式参数具有和 `auto` 变量相同的性质；唯一能作用域形式参数的存储类型是 `register`

```c
int a;
extern int b;
static int c;

void f(int d, register int e) {
	auto int g;
	int h;
	static int i;
	extern int j;
	register int k;
}
```

| 名字 | 存储期限 | 作用域 | 链接 |
| ---- | -------- | ------ | ---- |
|      |          |        |      |
|      |          |        |      |
|      |          |        |      |
|      |          |        |      |
|      |          |        |      |
|      |          |        |      |
|      |          |        |      |
|      |          |        |      |
|      |          |        |      |
|      |          |        |      |
|      |          |        |      |

